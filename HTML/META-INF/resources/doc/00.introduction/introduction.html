<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Pragma" content="no-cache">
		<meta http-equiv="Cache-Control" content="no-cache">
		<link type="text/css" href="../css/document.css" rel="stylesheet" />
		<style type="text/css">
		</style>
		<title>概要</title>
	</head>
	<body>
		<h1><span>1.</span>概要</h1>
		<h2>開発の目的</h2>
		<p>
			dataforms2.jarはJavaでWebアプリケーションを簡単に作るためフレームワークです。
		</p>
		<p>
			Webアプリケーションの場合、M(Model),V(View),C(Controller)モデルに準拠した作りが良いとされています。
			JavaにはM,V,Cにそれぞれ複数のライブラリが存在し、それを組み合わせてアプリケーションを作るケースが多いようです。
			このようなライブラリは確かに便利です。
			しかしこれらのライブラリはどんどん複雑になり巨大化しています。
			さらに依存ライブラリの数も増えいます。
			そのためちょっとしたシステムを作っただけなのに、数分かけて巨大なwarを作る作業を散々繰り返す羽目になってしまいます。
		</p>
		<p>
			大企業向けのシステムはこれでもいいかもしれませんが、中小企業向けのちょっとしたシステムや個人的なWebアプリケーションを作ろうとすると問題になります。
			このような場合、大抵Java以外のシステムを利用することになると思います。
			しかし私が一番慣れているのはJavaで、今更新たな言語を習得する気力がなくなってきました。
			ということで、M,V,Cの全てをシンプルなオリジナルライブラリで作成し、1つのjarにまとめてみました。
			ついでに今まで経験した既存のフレームワークの問題点を幾つか解決してみようと思い、このプロジェクトを開始しました。
		</p>
		<h2>特徴</h2>
		このフレームワークの特徴を以下にまとめます。
		<h3>1つのjarファイルにまとまっている</h3>
		<p>
			このフレームワークの本体は、1つのjarファイル(dataforms2.jar)にまとまっています。
			dataforms2.jarには、ライブラリ本体、アプリケーションの基本機能、開発ツールが入っています。
			Servletクラスもdataforms2.jarに入っており、web.xmlに設定を記述しなくても、*.dfというパターンで、DataFormsServletというServletが動作するようになっています。
			基本機能や開発ツールなどのページを構成するHTMLやJavascriptも、META-INF/resourcesに入っています。
			(これらはServlet 3.0でサポートされた機能を使用しています。)
			基本的にWEB-INF/libにdataforms2.jarと幾つかの依存ライブラリをコピーし、web.xmlにJNDIデータソースの設定を記述すれば動作します。
		</p>
		<h3>依存ライブラリが少ない</h3>
		<p>
			概要で述べた通り、このフレームワークの作成動機には、Javaで作成するWebアプリケーションの肥大化があります。
			そのため、依存するライブラリは必要最小限のjQuery,jQuery-ui,jsonic,apache-commonsのいくつかとpoiくらいになっています。
			この中で一番大きいのがpoiなのですが、Excelレポート出力を使用しないのであれば不要です。
			依存するライブラリの一覧を以下に示します。
		</p>
		<table class="jarlist">
			<caption>
				依存ライブラリ一覧
			</caption>
			<thead>
				<tr>
					<th style="width: 100px;">グルーブ</th>
					<th style="width: 300px;">ファイル</th>
					<th style="width: 400px;">コメント</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td rowspan="2">jQuery</td>
					<td>jQuery</td>
					<td rowspan="2">Javascriptライブラリ</td>
				</tr>
				<tr>
					<td>jQuery-ui</td>
				</tr>
				<tr>
					<td rowspan="5">commons</td>
					<td>commons-fileupload-XXX.jar</td>
					<td>ファイルのアップロード</td>
				</tr>
				<tr>
					<td>commons-lang3-XXX.jar</td>
					<td rowspan="2">実態参照変換</td>
				</tr>
				<tr>
					<td>commons-text-XXX.jar</td>
				</tr>
				<tr>
					<td>commons-validator-XXX.jar</td>
					<td>入力値のバリデーション</td>
				</tr>
				<tr>
					<td>commons-logging-XXX.jar</td>
					<td>poi,fopが参照</td>
				</tr>
				<tr>
					<td rowspan="12">poi</td>
					<td>poi-XXX.jar</td>
					<td rowspan="5">
						Excel出力で使用<br/>
						(Excel出力を使用しない場合は削除できます)
					</td>
				</tr>
				<tr>
					<td>poi-excelant-XXX.jar</td>
				</tr>
				<tr>
					<td>poi-ooxml-XXX.jar</td>
				</tr>
				<tr>
					<td>poi-ooxml-schemas-XXX.jar</td>
				</tr>
				<tr>
					<td>poi-scratchpad-XXX.jar</td>
				</tr>
				<tr>
					<td>commons-codec-XXX.jar</td>
					<td rowspan="7">
						POIが参照<br/>
						(Excel出力を使用しない場合は削除できます)
					</td>
				</tr>
				<tr>
					<td>commons-collections4-XXX.jar</td>
				</tr>
				<tr>
					<td>commons-compress-XXX.jar</td>
				</tr>
				<tr>
					<td>commons-math3-XXX.jar</td>
				</tr>
				<tr>
					<td>SparseBitSet-XXX.jar</td>
				</tr>
				<tr>
					<td>curvesapi-XXX.jar</td>
				</tr>
				<tr>
					<td>xmlbeans-XXX.jar</td>
				</tr>
				<tr>
					<td>jsonic</td>
					<td>jsonic-XXX.jar</td>
					<td>JSON変換</td>
				</tr>
				<tr>
					<td rowspan="2" >log4j2</td>
					<td>log4j-api-XXX.jar</td>
					<td rowspan="2">ログ出力</td>
				</tr>
				<tr>
					<td>log4j-core-XXX.jar</td>
				</tr>
				<tr>
					<td rowspan="8" >fop</td>
					<td>fop.jar</td>
					<td>
						PDF出力<br/>
						(PDF出力を使用しない場合は削除できます)
					</td>
				</tr>
				<tr>
					<td>batik-all-XXX.jar</td>
					<td rowspan="7">
						FOPが参照<br/>
						(PDF出力を使用しない場合は削除できます)
					</td>
				</tr>
				<tr>
					<td>commons-io-XXX.jar</td>
				</tr>
				<tr>
					<td>fontbox-XXX.jar</td>
				</tr>
				<tr>
					<td>serializer-XXX.jar</td>
				</tr>
				<tr>
					<td>xalan-XXX.jar</td>
				</tr>
				<tr>
					<td>xercesImpl-XXX.jar</td>
				</tr>
				<tr>
					<td>xmlgraphics-commons-XXX.jar</td>
				</tr>
			</tbody>
		</table>
		<h3>開発ツールを装備</h3>
		<p>
			DB上にテーブルを定義し、それを操作するページを作成する流れは以下のようになります。
		</p>
		<h4>開発手順の概要</h4>
		<ol>
			<li>Tableクラスから派生したテーブルのJavaクラスを作成。</li>
			<li>テーブルJavaクラスからDB中にテーブルを作成。</li>
			<li>テーブルJavaクラスを操作するためのページクラスを作成。</li>
			<li>ページクラスをからHTMLやJavascriptを作成。</li>
		</ol>
		<p>
			これらの操作だけで、とりあえず動作するページが出来上がります。
			また、これらの作業の大半は、開発ツールで行うことができます。
			後は、javadoc,とjsdocを参照しながら、機能を追加していくことになります。
		</p>
		<h3>DBのテーブル変更が容易</h3>
		<p>
			「詳細設計工程でテーブル定義は確定しています。」という言葉ほど、信用できないものはありません。
			単体テスト、結合テスト工程は当然のように、総合テストでも数回テーブル変更が発生する様なプロジェクトをよく見かけます。
			dataforms2.jarでは、テーブルJavaクラスの修正を行い、開発ツールでその変更をDBに適用するだけで対応できます。
			各DBサーバのマニュアルを調べて、テーブル修正用のスクリプトを作成する作業は不要です。
			当然テーブル中のデータも保持されます。
		</p>
		<h3>複数のデータベースサーバに対応</h3>
		<p>
			データベースは、独自のJavaクラスライブラリでsqlを記述せずに操作することが可能です。
			今のところ以下のデータベースに対応しており、Javaクラスライブラリを使用している限り、ソースコードの修正なしにデータベースを切り替えることができます。
			開発機では組み込みApache Derbyで単体テストまで行い、結合テスト～運用はPostgreSQLをインストールしたLinuxサーバで行うなんてことも可能になります。
		</p>
		<h4>対応しているデータベースサーバ</h4>
		<ol>
			<li>Apache Derby</li>
			<li>MySQL</li>
			<li>PostgreSQL</li>
			<li>Oracle</li>
		</ol>
		<p>
			データベースサーバに依存したSQLも、簡単に実行することができます。
			この場合は、データベースに合わせたコーディングが必要になります。
		</p>
		<h3>クラス化されたJavascriptライブラリ</h3>
		<p>
			Javaのページクラスにはフォームクラスのオブジェクトが配置され、フォームクラスにはフィールドクラスのオブジェクトが配置されています。
			dataforms2.jarでは、これらのJavaクラスに対応するJavascriptのクラスがES6の文法で記述されています。
			(Javascriptクラスが存在しなければ、親クラスのJavascriptクラスが自動的に操作します。)
			Javascriptクラスは、開発ツールで簡単に作成することができます。
			開発ツールで作成したjavascriptクラスに特殊な処理を記述することにより、独自の機能を追加していくとこができます。
		</p>
		<h3>ページの標準動作はクラスライブラリで実装済み</h3>
		<p>
			Javaのページクラスには複数のフォームクラスを配置できます。
			配置するフォームには以下の3種類が存在します。
		</p>
			<table>
				<caption>
					フォームクラスの種類
				</caption>
				<thead>
					<tr>
						<th>
							フォームクラス名
						</th>
						<th>
							説明
						</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>QueryForm</td>
						<td>
							問い合わせのための条件を入力し、問い合わせを実行するフォームです。
						</td>
					</tr>
					<tr>
						<td>QueryResultForm</td>
						<td>
							QueryFormで入力した条件を元に問い合わせを行い、その結果を表示するフォームです。
						</td>
					</tr>
					<tr>
						<td>EditForm</td>
						<td>
							指定されたデータの入力、編集を行うためのフォームです。
						</td>
					</tr>
				</tbody>
			</table>
		<p>
			ページのJavaクラス作成ツールでは、これらの3種類のフォームの有無を指定できます。
			三種類全てのフォームを配置した場合、QueryFormに入力した条件を元にQueryResultFormが問い合わせ結果を表示します。
			表示したデータのリンクをクリックすると、EditFormが表示され、指定されたデータを編集することができます。
			このような動作はPageクラスと各種Formクラス中に実装されています。
			そのためフォームを配置するだけで、適切な動作をするアプリケーションになります。
		</p>
		<p>
			EditFormを省略すれは、問い合わせのみのページになります。
			また、EditFormのみを配置すれば、ユーザの登録情報の変更ページのように、決まったテーブルのレコードを修正するようなページを作ることもできます。
		</p>
		<p>
			EditFormの入力後確認ボタンを押下すると、EditFormがロックされ、確認画面になります。
			他のフレームワークでは、これらの確認画面専用のHTMLを用意するケースを見かけますが、dataforms2.jarは編集用のフォームの各フィールドをロックすることによって実現しています。
			そのため、確認ページ用のHTMLを用意する必要がありません。
			確認画面が不要な場合、HTMLから「確認」ボタンを削除してください。
			これだけで最初から登録ボタンが表示され、確認画面を経由せず保存できるようになります。
		</p>
		<p>
			dataforms2.jarでは、HTMLの&lt;table&gt;タグに対応するHtmlTableクラスが用意されています。
			HtmlTableクラスのサブクラスには、以下の物があります。
		</p>

		<table>
			<caption>テーブルクラスの種類</caption>
			<thead>
				<tr>
					<th>
						テーブルクラス名
					</th>
					<th>
						説明
					</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>HtmlTable</td>
					<td>
						テーブルにデータを表示するだけの単純なテーブルです。
					</td>
				</tr>
				<tr>
					<td>PageScrollHtmlTable</td>
					<td>
						指定した件数でページスクロールする機能をサポートしたテーブルです。
						通常QueryResultFormに配置します。
					</td>
				</tr>
				<tr>
					<td>EdiableHtmlTable</td>
					<td>
						編集可能なテーブルクラスです。行の追加、削除、ドラッグによる順序変更をサポートします。
					</td>
				</tr>
			</tbody>
		</table>
		<p>
			これらのテーブルクラスをフォームに配置するだけで、標準的なイベント処理が自動的に組み込まれます。
		</p>
		<h3>アプリケーションの基本機能を装備</h3>
		<p>
			dataforms2.jarの中には、開発ツールの他にユーザの管理、ログインログアウトの機能を標準装備しています。
			これらの機能の実装は単純ですが、システムごとに実装するのも意外と面倒なものです。
			dataforms2.jarを使用すれば、このような手間をなくすことができます。
		</p>
		<p>
			また、これらの機能は必要最小限のものになっています。
			そのため、既存のページを機能が追加された別のページに差し替える機能を持っています。
		</p>
		<h3>デザイナーさんにお任せできるViewの実現</h3>
		<p>
			開発ツールで作成されたHTMLを確認してみるとわかると思いますが、標準的なHTMLのみで、Javascript、onxxxx等のイベント関連アトリビュート、ライブラリが定義する特殊なアトリビュートも存在しません。
			これが何故動作するのか不思議に思うかもしれませんが、dataforms2.jarがこのページの初期化スクリプトを自動的に生成するので、所定のイベント処理が自動的に組み込まれます。
			つまりHTMLは純粋に見た目だけを記述することになり、外見はHTMLやCSSの文法を理解しているデザイナーさんにお任せすることができます。
		</p>
		<p>
			広告的性格が強いWebアプリケーションでは、当然のようにデザインが重視されます。
			このような場合、デザイン面の調整に時間を取られ、システムのデバックがほぼ完了した段階でデザインが届き、泣きながらjspに組み込むなんてことが発生します。
			jspにはJavascriptやScriptletが混在するので、修正すれば一部テストはやり直しになります。
			その挙句、デザイナーさんから「ここが1ドットずれています。」なんてクレームが来たりします。
			これがdataforms2.jarでjspを採用しなかった理由です。
			このような開発の場合、dataforms2.jarのEclipseプロジェクトを作成して、「このcssとhtmlはお任せします。」とやっています。
		</p>
		<h3>フレームデザインの共通化</h3>
		<p>
			dataforms2.jarでは、各ページに共通したフレームデザインが設定されており、それを切り替えることが可能です。
			dataforms2.jarの中には、/frame/defaultというパスにFrameデザインを記録したHTMLやcssが入っています。
			デザイン性を重視しない場合はこのまま使用してもよいですし、デザインに凝りたい場合、これをカスタマイズすることも可能です。
		</p>
		<p>
			各ページのHTMLは、body直下に"mainDiv"というIDのdivが存在し、そのmainDivの中にページ固有の内容が記述されています。
			このページはそのままブラウザに転送され、その後ページの初期化スクリプトでFrame.htmlからヘッダ、フッタ、メニューなどを取得しmainDivの周りに配置します。
		</p>
		<h3>デバイスに依存しないフレームデザイン(レスポンシブデザイン)</h3>
		<p>
			現在のWebアプリケーションは、PCだけでなく、タブレット、スマートフォンに対応する必要があります。
			前述のフレームの設定には、Frame.css,FramePC.css,FranmeTB.css,FrameSP.cssのスタイルシートが存在し、それぞれ全デバイス共通スタイル、PC用スタイル、タブレット用スタイル、スマートフォン用スタイルが設定されています。
			PCのブラウザでdataforms2.jarの各ページを表示し、ブラウザのサイズを変更すると、各画面サイズに応じてレイアウトが変化するはずです。
		</p>
		<h3>多言語対応</h3>
		<p>
			各言語用のhtmlやpropertiesを用意することによって、ブラウザに設定された言語に応じて、出力するHTMLを切り替えることができます。
			現在のところ、開発ツールは日本語ページしかありませんが、基本機能(/dataforms/app/page/*.df)は英語と日本語のページが作成されています。
			(ただし英文は機械翻訳ですが...)。
		</p>
		<hr/>
	</body>
</html>
